{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the ScriptSync application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "User's username."
        }
      },
      "required": [
        "id",
        "email",
        "username"
      ]
    },
    "Script": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Script",
      "type": "object",
      "description": "Represents a screenplay or script document.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Script entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the screenplay."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Script).  The user ID of the script's author."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the script was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the script was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "authorId",
        "createdAt",
        "updatedAt"
      ]
    },
    "Scene": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Scene",
      "type": "object",
      "description": "Represents a scene within a screenplay.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Scene entity."
        },
        "scriptId": {
          "type": "string",
          "description": "Reference to Script. (Relationship: Script 1:N Scene).  The script ID this scene belongs to."
        },
        "sceneNumber": {
          "type": "number",
          "description": "The scene number within the script."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the scene."
        },
        "estimatedDuration": {
          "type": "number",
          "description": "Estimated duration of the scene in minutes."
        }
      },
      "required": [
        "id",
        "scriptId",
        "sceneNumber",
        "description"
      ]
    },
    "Character": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Character",
      "type": "object",
      "description": "Represents a character in a screenplay.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Character entity."
        },
        "scriptId": {
          "type": "string",
          "description": "Reference to Script. (Relationship: Script 1:N Character). The script ID this character belongs to."
        },
        "name": {
          "type": "string",
          "description": "Name of the character."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the character."
        }
      },
      "required": [
        "id",
        "scriptId",
        "name",
        "description"
      ]
    },
    "SceneCharacter": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SceneCharacter",
      "type": "object",
      "description": "Represents the relationship between scenes and characters, indicating which characters appear in which scenes.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SceneCharacter entity."
        },
        "sceneId": {
          "type": "string",
          "description": "Reference to Scene. (Relationship: Scene N:N Character).  The scene ID."
        },
        "characterId": {
          "type": "string",
          "description": "Reference to Character. (Relationship: Character N:N Scene). The character ID."
        }
      },
      "required": [
        "id",
        "sceneId",
        "characterId"
      ]
    },
    "Collaboration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Collaboration",
      "type": "object",
      "description": "Represents a collaboration session between users on a specific script.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Collaboration entity."
        },
        "scriptId": {
          "type": "string",
          "description": "Reference to Script. (Relationship: Script 1:N Collaboration).  The script ID being collaborated on."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Collaboration). The user ID participating in the collaboration."
        },
        "role": {
          "type": "string",
          "description": "The role of the user in the collaboration (e.g., editor, viewer)."
        },
        "permissions": {
          "type": "string",
          "description": "Permissions granted to the user for the collaboration."
        }
      },
      "required": [
        "id",
        "scriptId",
        "userId",
        "role",
        "permissions"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership ensures only the user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/scripts/{scriptId}",
        "definition": {
          "entityName": "Script",
          "schema": {
            "$ref": "#/backend/entities/Script"
          },
          "description": "Stores scripts created by the user. The 'authorId' field within the script document contains the userId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user (script author)."
            },
            {
              "name": "scriptId",
              "description": "The unique ID of the script."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/scripts/{scriptId}/scenes/{sceneId}",
        "definition": {
          "entityName": "Scene",
          "schema": {
            "$ref": "#/backend/entities/Scene"
          },
          "description": "Stores scenes within a specific script. Accessed only by the script author.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user (script author)."
            },
            {
              "name": "scriptId",
              "description": "The unique ID of the script."
            },
            {
              "name": "sceneId",
              "description": "The unique ID of the scene."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/scripts/{scriptId}/characters/{characterId}",
        "definition": {
          "entityName": "Character",
          "schema": {
            "$ref": "#/backend/entities/Character"
          },
          "description": "Stores characters within a specific script. Accessed only by the script author.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user (script author)."
            },
            {
              "name": "scriptId",
              "description": "The unique ID of the script."
            },
            {
              "name": "characterId",
              "description": "The unique ID of the character."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/scripts/{scriptId}/sceneCharacters/{sceneCharacterId}",
        "definition": {
          "entityName": "SceneCharacter",
          "schema": {
            "$ref": "#/backend/entities/SceneCharacter"
          },
          "description": "Stores relationships between scenes and characters within a specific script. Accessed only by the script author.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user (script author)."
            },
            {
              "name": "scriptId",
              "description": "The unique ID of the script."
            },
            {
              "name": "sceneCharacterId",
              "description": "The unique ID of the SceneCharacter."
            }
          ]
        }
      },
      {
        "path": "/collaborations/{collaborationId}",
        "definition": {
          "entityName": "Collaboration",
          "schema": {
            "$ref": "#/backend/entities/Collaboration"
          },
          "description": "Stores collaboration sessions.  Access is controlled by verifying the user's ID and role. The data model is designed so the role will dictate permissions.",
          "params": [
            {
              "name": "collaborationId",
              "description": "The unique ID of the collaboration session."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support a collaborative screenwriting application (ScriptSync) with a focus on robust security and scalability. The design emphasizes Authorization Independence, eliminating the need for `get()` calls in security rules by denormalizing authorization data. It uses structural segregation to ensure that all documents within a collection share the same security requirements, simplifying the security rules.\n\n**Authorization Independence and QAPs:**\n\n*   **User-Owned Data:** Scripts, Scenes, Characters, and SceneCharacters are organized under `/users/{userId}`, ensuring that only the owner can access them by default. The `authorId` field in `Script` documents is used to enforce ownership.\n*   **Collaboration Data:** The `/collaborations/{collaborationId}` collection stores collaboration data. Each document contains the `scriptId`, `userId`, `role`, and `permissions`. QAPs for collaborations will be based on verifying membership in the collaboration and the role and permissions associated with each user. The structure assumes that the role determines the permissions.\n\n\nThis design enables listing scripts accessible to a specific user: `scripts` collection is queried by the logged-in user ID.\n\n\n**Error Fix**: The error reported, `FirebaseError: Firebase: Error (auth/operation-not-allowed)`, indicates an issue with Firebase Authentication configuration. Ensure that Password sign-in is enabled for the Firebase project.\n"
  }
}